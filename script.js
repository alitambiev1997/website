// Translations
const translations = {
    en: {
        nav_about: "About",
        nav_services: "Services",
        nav_testimonials: "Testimonials",
        nav_contact: "Contact",
        nav_book: "Book Free Call",

        hero_title: "Friendly, Effective & Stress-Free English Lessons",
        hero_subtitle: "Unlock your potential with personalized lessons. From conversation practice to Cambridge exam prep and Business English.",
        hero_cta: "Book Your Free Call",
        hero_services: "Explore Services",
        hero_note: "âœ¨ First lesson is free & commitment-free!",

        about_title: "Hi, I'm Ali",
        about_text1: "I believe learning English should be fun, not stressful. My goal is to help you feel confident and capable in any conversation.",
        about_text2: "With a flexible approach tailored to your needs, we'll polish your grammar, expand your vocabulary, and get you speaking fluently. Whether you're a student preparing for exams or a professional looking to advance your career, I'm here to guide you.",
        stat_years: "Years Experience",
        stat_students: "Happy Students",

        services_title: "How Can I Help You?",
        services_subtitle: "Tailored lessons for every goal.",
        service_1_title: "1:1 Lessons",
        service_1_desc: "Personalized attention focused entirely on your specific needs and pace.",
        service_2_title: "Group Lessons",
        service_2_desc: "Learn with friends or colleagues in a fun, interactive environment.",
        service_3_title: "Cambridge Prep",
        service_3_desc: "Structured preparation for FCE, CAE, and CPE exams with proven strategies.",
        service_4_title: "Business English",
        service_4_desc: "Master professional communication, presentations, and negotiations.",
        service_5_title: "Corporate Training",
        service_5_desc: "Language benefits for your employees to boost team communication.",
        service_6_title: "Conversation",
        service_6_desc: "Relaxed chats to improve fluency and reduce speaking anxiety.",

        testimonials_title: "What Students Say",
        testimonial_1_text: "\"I finally feel confident speaking in meetings! The lessons are always fun and relevant to my job.\"",
        testimonial_2_text: "\"Passed my CAE exam with flying colors thanks to the excellent preparation and tips.\"",
        testimonial_3_text: "\"The best English teacher I've ever had. Patient, funny, and really knows how to explain grammar.\"",

        cta_title: "Ready to Improve Your English?",
        cta_subtitle: "Book your free introductory call today. No commitment, just a friendly chat to see how I can help.",
        cta_note: "* Please note: This is a demo Calendly link.",

        contact_title: "Get in Touch",
        contact_text: "Have questions? Prefer to email? Fill out the form below or send me a message directly.",
        form_name: "Name",
        form_email: "Email",
        form_message: "Message",
        form_submit: "Send Message",
        form_success: "Thank you! Your message has been sent.",
        form_error: "Oops! Something went wrong. Please try again.",

        // GDPR Translations
        cookie_text: "We use cookies to ensure you get the best experience on our website.",
        cookie_accept: "Accept",
        privacy_title: "Privacy Policy",
        privacy_intro: "This Privacy Policy describes how your personal information is collected, used, and shared when you visit or make a purchase from English with Ali.",
        privacy_collection_title: "Personal Information We Collect",
        privacy_collection_text: "When you visit the Site, we automatically collect certain information about your device, including information about your web browser, IP address, time zone, and some of the cookies that are installed on your device.",
        privacy_usage_title: "How We Use Your Personal Information",
        privacy_usage_text: "We use the Order Information that we collect generally to fulfill any orders placed through the Site.",
        form_consent: "I agree to the processing of my personal data according to the Privacy Policy."
    },
    cz: {
        nav_about: "O mnÄ›",
        nav_services: "SluÅ¾by",
        nav_testimonials: "Reference",
        nav_contact: "Kontakt",
        nav_book: "Rezervovat hovor",
        hero_title: "PÅ™Ã¡telskÃ©, efektivnÃ­ a bezstresovÃ© lekce angliÄtiny",
        hero_subtitle: "OdemknÄ›te svÅ¯j potenciÃ¡l s lekcemi na mÃ­ru. Od konverzace po pÅ™Ã­pravu na Cambridge zkouÅ¡ky a obchodnÃ­ angliÄtinu.",
        hero_cta: "Rezervovat ÃºvodnÃ­ hovor",
        hero_services: "Prozkoumat sluÅ¾by",
        hero_note: "âœ¨ PrvnÃ­ lekce je zdarma a nezÃ¡vaznÃ¡!",
        about_title: "Ahoj, jsem Ali",
        about_text1: "VÄ›Å™Ã­m, Å¾e uÄenÃ­ angliÄtiny by mÄ›la bÃ½t zÃ¡bava, ne stres. MÃ½m cÃ­lem je, abyste se cÃ­tili sebejistÄ› v jakÃ©koli konverzaci.",
        about_text2: "S flexibilnÃ­m pÅ™Ã­stupem na mÃ­ru vaÅ¡im potÅ™ebÃ¡m vypilujeme gramatiku, rozÅ¡Ã­Å™Ã­me slovnÃ­ zÃ¡sobu a rozmluvÃ­me vÃ¡s. AÅ¥ uÅ¾ jste student pÅ™ipravujÃ­cÃ­ se na zkouÅ¡ky nebo profesionÃ¡l, kterÃ½ chce posunout svou kariÃ©ru, jsem tu pro vÃ¡s.",
        stat_years: "Let zkuÅ¡enostÃ­",
        stat_students: "SpokojenÃ½ch studentÅ¯",
        services_title: "Jak vÃ¡m mohu pomoci?",
        services_subtitle: "Lekce na mÃ­ru pro kaÅ¾dÃ½ cÃ­l.",
        service_1_title: "1:1 Lekce",
        service_1_desc: "OsobnÃ­ pÅ™Ã­stup zamÄ›Å™enÃ½ zcela na vaÅ¡e potÅ™eby a tempo.",
        service_2_title: "SkupinovÃ© lekce",
        service_2_desc: "UÄte se s pÅ™Ã¡teli nebo kolegy v zÃ¡bavnÃ©m, interaktivnÃ­m prostÅ™edÃ­.",
        service_3_title: "PÅ™Ã­prava na Cambridge",
        service_3_desc: "StrukturovanÃ¡ pÅ™Ã­prava na zkouÅ¡ky FCE, CAE a CPE s ovÄ›Å™enÃ½mi strategiemi.",
        service_4_title: "ObchodnÃ­ angliÄtina",
        service_4_desc: "Osvojte si profesionÃ¡lnÃ­ komunikaci, prezentace a vyjednÃ¡vÃ¡nÃ­.",
        service_5_title: "FiremnÃ­ vÃ½uka",
        service_5_desc: "JazykovÃ© benefity pro vaÅ¡e zamÄ›stnance pro zlepÅ¡enÃ­ tÃ½movÃ© komunikace.",
        service_6_title: "Konverzace",
        service_6_desc: "UvolnÄ›nÃ© povÃ­dÃ¡nÃ­ pro zlepÅ¡enÃ­ plynulosti a odbourÃ¡nÃ­ strachu z mluvenÃ­.",
        testimonials_title: "Co Å™Ã­kajÃ­ studenti",
        testimonial_1_text: "KoneÄnÄ› se cÃ­tÃ­m sebejistÄ› pÅ™i mluvenÃ­ na poradÃ¡ch! Lekce jsou vÅ¾dy zÃ¡bavnÃ© a relevantnÃ­ pro mou prÃ¡ci.",
        testimonial_2_text: "SloÅ¾il jsem zkouÅ¡ku CAE na vÃ½bornou dÃ­ky skvÄ›lÃ© pÅ™Ã­pravÄ› a tipÅ¯m.",
        testimonial_3_text: "NejlepÅ¡Ã­ uÄitel angliÄtiny, jakÃ©ho jsem kdy mÄ›la. TrpÄ›livÃ½, vtipnÃ½ a opravdu umÃ­ vysvÄ›tlit gramatiku.",
        cta_title: "Jste pÅ™ipraveni zlepÅ¡it svou angliÄtinu?",
        cta_subtitle: "Rezervujte si ÃºvodnÃ­ hovor zdarma jeÅ¡tÄ› dnes. Å½Ã¡dnÃ© zÃ¡vazky, jen pÅ™Ã¡telskÃ½ pokec o tom, jak vÃ¡m mohu pomoci.",
        cta_note: "* PoznÃ¡mka: Toto je demo odkaz na Calendly.",
        contact_title: "NapiÅ¡te mi",
        contact_text: "MÃ¡te otÃ¡zky? Preferujete email? VyplÅˆte formulÃ¡Å™ nÃ­Å¾e nebo mi poÅ¡lete zprÃ¡vu pÅ™Ã­mo.",
        form_name: "JmÃ©no",
        form_email: "Email",
        form_message: "ZprÃ¡va",
        form_submit: "Odeslat zprÃ¡vu",
        form_success: "DÄ›kuji! VaÅ¡e zprÃ¡va byla odeslÃ¡na.",
        form_error: "Jejda! NÄ›co se pokazilo. Zkuste to prosÃ­m znovu.",

        // GDPR Translations
        cookie_text: "PouÅ¾Ã­vÃ¡me cookies k zajiÅ¡tÄ›nÃ­ co nejlepÅ¡Ã­ho zÃ¡Å¾itku na naÅ¡em webu.",
        cookie_accept: "PÅ™ijmout",
        privacy_title: "ZÃ¡sady ochrany osobnÃ­ch ÃºdajÅ¯",
        privacy_intro: "Tyto ZÃ¡sady ochrany osobnÃ­ch ÃºdajÅ¯ popisujÃ­, jak jsou vaÅ¡e osobnÃ­ Ãºdaje shromaÅ¾ÄovÃ¡ny, pouÅ¾Ã­vÃ¡ny a sdÃ­leny, kdyÅ¾ navÅ¡tÃ­vÃ­te web English with Ali.",
        privacy_collection_title: "OsobnÃ­ Ãºdaje, kterÃ© shromaÅ¾Äujeme",
        privacy_collection_text: "KdyÅ¾ navÅ¡tÃ­vÃ­te web, automaticky shromaÅ¾Äujeme urÄitÃ© informace o vaÅ¡em zaÅ™Ã­zenÃ­, vÄetnÄ› informacÃ­ o vaÅ¡em webovÃ©m prohlÃ­Å¾eÄi, IP adrese, ÄasovÃ©m pÃ¡smu a nÄ›kterÃ½ch cookies nainstalovanÃ½ch ve vaÅ¡em zaÅ™Ã­zenÃ­.",
        privacy_usage_title: "Jak pouÅ¾Ã­vÃ¡me vaÅ¡e osobnÃ­ Ãºdaje",
        privacy_usage_text: "Informace o objednÃ¡vce, kterÃ© shromaÅ¾Äujeme, pouÅ¾Ã­vÃ¡me obecnÄ› k plnÄ›nÃ­ jakÃ½chkoli objednÃ¡vek zadanÃ½ch prostÅ™ednictvÃ­m webu.",
        form_consent: "SouhlasÃ­m se zpracovÃ¡nÃ­m osobnÃ­ch ÃºdajÅ¯ dle ZÃ¡sad ochrany osobnÃ­ch ÃºdajÅ¯."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Language Logic
    const langToggleBtns = document.querySelectorAll('[data-lang-toggle]');
    let currentLang = localStorage.getItem('preferredLang');

    // IP Detection
    if (!currentLang) {
        // Default to English initially
        currentLang = 'en';

        // Try to detect country
        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                if (data.country_code === 'CZ') {
                    updateLanguage('cz');
                }
            })
            .catch(error => {
                console.log('IP detection failed, defaulting to EN', error);
            });
    }

    function updateLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('preferredLang', lang);

        // Update button text (Show the OTHER language option)
        langToggleBtns.forEach(btn => {
            if (lang === 'en') {
                btn.textContent = 'ðŸ‡¨ðŸ‡¿ CZ';
            } else {
                btn.textContent = 'ðŸ‡¬ðŸ‡§ EN';
            }
        });

        // Update all elements with data-i18n attribute
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                element.textContent = translations[lang][key];
            }
        });

        // Update html lang attribute
        document.documentElement.lang = lang;
    }

    // Initialize language
    updateLanguage(currentLang);

    // Toggle language on click
    langToggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'cz' : 'en';
            updateLanguage(newLang);
        });
    });

    // Mobile Menu
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const navLinks = document.querySelector('.nav-links');

    mobileMenuBtn.addEventListener('click', () => {
        navLinks.classList.toggle('active');

        // Animate hamburger to X
        const spans = mobileMenuBtn.querySelectorAll('span');
        if (navLinks.classList.contains('active')) {
            spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            spans[1].style.opacity = '0';
            spans[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
        } else {
            spans[0].style.transform = 'none';
            spans[1].style.opacity = '1';
            spans[2].style.transform = 'none';
        }
    });

    // Close mobile menu when clicking a link
    document.querySelectorAll('.nav-links a').forEach(link => {
        link.addEventListener('click', () => {
            navLinks.classList.remove('active');
            const spans = mobileMenuBtn.querySelectorAll('span');
            spans[0].style.transform = 'none';
            spans[1].style.opacity = '1';
            spans[2].style.transform = 'none';
        });
    });

    // Testimonial Carousel
    const track = document.querySelector('.carousel-track');
    const slides = Array.from(track.children);
    const nextButton = document.querySelector('.carousel-btn.next');
    const prevButton = document.querySelector('.carousel-btn.prev');

    // Recalculate slide width on resize
    let slideWidth = slides[0].getBoundingClientRect().width;
    window.addEventListener('resize', () => {
        slideWidth = slides[0].getBoundingClientRect().width;
        slides.forEach(setSlidePosition);
    });

    const setSlidePosition = (slide, index) => {
        slide.style.left = slideWidth * index + 'px';
    };
    slides.forEach(setSlidePosition);

    const moveToSlide = (track, currentSlide, targetSlide) => {
        track.style.transform = 'translateX(-' + targetSlide.style.left + ')';
        currentSlide.classList.remove('current-slide');
        targetSlide.classList.add('current-slide');
    };

    // Next button
    nextButton.addEventListener('click', () => {
        const currentSlide = track.querySelector('.current-slide');
        let nextSlide = currentSlide.nextElementSibling;

        if (!nextSlide) {
            nextSlide = slides[0]; // Loop back to start
        }

        moveToSlide(track, currentSlide, nextSlide);
    });

    // Prev button
    prevButton.addEventListener('click', () => {
        const currentSlide = track.querySelector('.current-slide');
        let prevSlide = currentSlide.previousElementSibling;

        if (!prevSlide) {
            prevSlide = slides[slides.length - 1]; // Loop to end
        }

        moveToSlide(track, currentSlide, prevSlide);
    });

    // Auto rotate
    setInterval(() => {
        const currentSlide = track.querySelector('.current-slide');
        let nextSlide = currentSlide.nextElementSibling;
        if (!nextSlide) nextSlide = slides[0];
        moveToSlide(track, currentSlide, nextSlide);
    }, 5000);

    // Contact Form Handling
    const contactForm = document.getElementById('contact-form');
    const formStatus = document.getElementById('form-status');

    contactForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Simulate form submission
        const formData = new FormData(contactForm);
        const name = formData.get('name');
        const email = formData.get('email');

        if (name && email) {
            formStatus.textContent = translations[currentLang].form_success;
            formStatus.className = 'form-status success';
            contactForm.reset();

            setTimeout(() => {
                formStatus.textContent = '';
                formStatus.className = 'form-status';
            }, 5000);
        } else {
            formStatus.textContent = translations[currentLang].form_error;
            formStatus.className = 'form-status error';
        }
    });

    // GDPR Logic
    // Cookie Banner
    const cookieBanner = document.getElementById('cookie-banner');
    const acceptCookiesBtn = document.getElementById('accept-cookies');

    if (!localStorage.getItem('cookiesAccepted')) {
        setTimeout(() => {
            cookieBanner.classList.add('active');
        }, 1000);
    }

    acceptCookiesBtn.addEventListener('click', () => {
        localStorage.setItem('cookiesAccepted', 'true');
        cookieBanner.classList.remove('active');
    });

    // Privacy Modal
    const privacyModal = document.getElementById('privacy-modal');
    const privacyLink = document.getElementById('privacy-link');
    const modalClose = document.querySelector('.modal-close');

    if (privacyLink) {
        privacyLink.addEventListener('click', (e) => {
            e.preventDefault();
            privacyModal.classList.add('active');
        });
    }

    if (modalClose) {
        modalClose.addEventListener('click', () => {
            privacyModal.classList.remove('active');
        });
    }

    // Close modal on outside click
    window.addEventListener('click', (e) => {
        if (e.target === privacyModal) {
            privacyModal.classList.remove('active');
        }
    });
});
